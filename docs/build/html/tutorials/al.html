

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>On-the-fly aluminum potential &mdash; flare 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="On-the-fly training using ASE" href="ase.html" />
    <link rel="prev" title="Tutorials" href="tutorials.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> flare
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">On-the-fly aluminum potential</a></li>
<li class="toctree-l2"><a class="reference internal" href="ase.html">On-the-fly training using ASE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flare/flare.html">Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/contribute.html">How To Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">flare</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>On-the-fly aluminum potential</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/al.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="on-the-fly-aluminum-potential">
<h1>On-the-fly aluminum potential<a class="headerlink" href="#on-the-fly-aluminum-potential" title="Permalink to this headline">¶</a></h1>
<p>Here we give an example of running OTF (on-the-fly) training with QE (Quantum Espresso) and NVE ensemble. We use our unit test file as illustration (<cite>test_OTF_qe.py</cite>)</p>
<p>First, let’s set up a GP model with three-body kernel function.</p>
<ul class="simple">
<li><cite>kernel_grad</cite>: set to be the gradient of kernel function used for hyperparameter training.</li>
<li><cite>hyps</cite>: the array of hyperparameters, whose names are shown in <cite>hyp_labels</cite>.</li>
<li><cite>cutoffs</cite>: consists of two values. The 1st is the cutoff of two-body and the 2nd is for three-body kernel. Usually we will set a larger one for two-body.</li>
<li><cite>energy_force_kernel</cite>: set to calculate local energy for each atom based on the integral of forces.</li>
<li><cite>maxiter</cite>: set to constrain the number of steps in training hyperparameters.</li>
</ul>
<p><strong>Note:</strong> If you are trying multi-component system, please use kernel functions in <cite>mc_simple.py</cite> instead of <cite>kernels.py</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># make gp model</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">en</span><span class="o">.</span><span class="n">three_body</span>
    <span class="n">kernel_grad</span> <span class="o">=</span> <span class="n">en</span><span class="o">.</span><span class="n">three_body_grad</span>
    <span class="n">hyps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
    <span class="n">hyp_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Signal Std&#39;</span><span class="p">,</span> <span class="s1">&#39;Length Scale&#39;</span><span class="p">,</span> <span class="s1">&#39;Noise Std&#39;</span><span class="p">]</span>
    <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.9</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">])</span>
    <span class="n">energy_force_kernel</span> <span class="o">=</span> <span class="n">en</span><span class="o">.</span><span class="n">three_body_force_en</span>

    <span class="n">gp</span> <span class="o">=</span> \
        <span class="n">GaussianProcess</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
                        <span class="n">kernel_grad</span><span class="o">=</span><span class="n">kernel_grad</span><span class="p">,</span>
                        <span class="n">hyps</span><span class="o">=</span><span class="n">hyps</span><span class="p">,</span>
                        <span class="n">cutoffs</span><span class="o">=</span><span class="n">cutoffs</span><span class="p">,</span>
                        <span class="n">hyp_labels</span><span class="o">=</span><span class="n">hyp_labels</span><span class="p">,</span>
                        <span class="n">energy_force_kernel</span><span class="o">=</span><span class="n">energy_force_kernel</span><span class="p">,</span>
                        <span class="n">maxiter</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to set up DFT calculator, here we use QE (quantum espresso). Suppose we’ve prepared a QE input file in current directory <cite>./pwscf.in</cite>, and have set the environment variable <cite>PWSCF_COMMAND</cite> to the location of our QE’s executable <cite>pw.x</cite>. Then we specify the input file and executable by <cite>qe_input</cite> and <cite>dft_loc</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># set up DFT calculator</span>
    <span class="n">qe_input</span> <span class="o">=</span> <span class="s1">&#39;./pwscf.in&#39;</span> <span class="c1"># quantum espresso input file</span>
    <span class="n">dft_loc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PWSCF_COMMAND&#39;</span><span class="p">)</span> 
</pre></div>
</div>
<p>Then we can set up our OTF MD engine.</p>
<ul class="simple">
<li><cite>dt</cite>: the time step in unit of <em>ps</em></li>
<li><cite>number_of_steps</cite>: the number of steps that the MD is run</li>
<li><cite>std_tolerance_factor</cite>: the uncertainty threshold = std_tolerance_factor x hyps[-1]. In OTF training, when GP predicts uncertainty above the uncertainty threshold, it will call DFT</li>
<li><cite>max_atoms_added</cite>: constrain the number of atoms added to the training set after each DFT call</li>
<li><cite>freeze_hyps</cite>: stop training hyperparameters and fix them from the <cite>freeze_hyps</cite> th step. Usually set to a small number, because for large dataset the training will take long.</li>
<li><cite>init_atoms</cite>: list of atoms to be added in the first DFT call. Because there’s no uncertainty predicted in the initial DFT call, so there’s no selection rule to pick up “maximully uncertain” atoms into the training set, we have to specify which atoms to pick up by this variable.</li>
<li><cite>calculate_energy</cite>: if <cite>True</cite>, the local energy on each atom will be calculated</li>
<li><cite>output_name</cite>: the name of the logfile</li>
<li><cite>skip</cite>: record/dump the information every <cite>skip</cite> steps.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># set up OTF parameters</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>                  <span class="c1"># timestep (ps)</span>
    <span class="n">number_of_steps</span> <span class="o">=</span> <span class="mi">100</span>       <span class="c1"># number of steps</span>
    <span class="n">std_tolerance_factor</span> <span class="o">=</span> <span class="mi">1</span>   
    <span class="n">max_atoms_added</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">freeze_hyps</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">otf</span> <span class="o">=</span> <span class="n">OTF</span><span class="p">(</span><span class="n">qe_input</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">,</span> <span class="n">gp</span><span class="p">,</span> <span class="n">dft_loc</span><span class="p">,</span>
              <span class="n">std_tolerance_factor</span><span class="p">,</span> <span class="n">init_atoms</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">calculate_energy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_name</span><span class="o">=</span><span class="s1">&#39;al_otf_qe&#39;</span><span class="p">,</span>
              <span class="n">freeze_hyps</span><span class="o">=</span><span class="n">freeze_hyps</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
              <span class="n">max_atoms_added</span><span class="o">=</span><span class="n">max_atoms_added</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, let’s run it!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># run OTF MD</span>
    <span class="n">otf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>After OTF training is finished, we can check log file <cite>al_otf_qe.out</cite> for all the information dumped. This output file can be parsed using our <cite>otf_parser.py</cite> module, which we will give an introduction later.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ase.html" class="btn btn-neutral float-right" title="On-the-fly training using ASE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jonathan Vandermause

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>